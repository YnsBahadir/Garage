@using EntityLayer.Concrete
@using DataAccessLayer.Concrete
@model List<Product>

@{
    ViewData["Title"] = "Ana Sayfa";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    int firsatUrunId = 1005;

    Context c = new Context();
    var firsatUrunu = c.Products.Find(firsatUrunId);
}

<style>
    .carousel-item {
        height: 400px;
        background-color: #1c1c1c; 
        position: relative;
        overflow: hidden;
    }

    .carousel-caption-custom {
        position: absolute;
        top: 50%;
        left: 10%;
        transform: translateY(-50%);
        text-align: left;
        z-index: 2;
        max-width: 600px;
    }

    .carousel-indicators button {
        width: 10px !important;
        height: 10px !important;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.3) !important;
        margin: 0 5px !important;
        transition: all 0.3s ease;
    }

    .carousel-indicators .active {
        width: 30px !important;
        border-radius: 10px !important;
        background-color: #FFD700 !important;
    }

    .hero-pattern {
        position: absolute;
        top: 0;
        right: 0;
        width: 50%;
        height: 100%;
        background: linear-gradient(135deg, transparent 0%, rgba(255, 215, 0, 0.1) 100%);
        clip-path: polygon(25% 0%, 100% 0%, 100% 100%, 0% 100%);
    }

    .product-card {
        border: none;
        border-radius: 15px;
        background-color: #fff;
        transition: all 0.3s ease;
        overflow: hidden;
    }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1) !important;
        }

    .card-img-wrapper {
        height: 220px;
        overflow: hidden;
        position: relative;
        background-color: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card-img-top {
        height: 100%;
        width: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .product-card:hover .card-img-top {
        transform: scale(1.05); 
    }

    .list-group-item {
        border: none;
        border-bottom: 1px solid #f0f0f0;
        padding: 15px 20px;
        font-weight: 500;
        color: #555;
        transition: all 0.2s;
    }

        .list-group-item:hover {
            background-color: #fffbf0;
            color: #000;
            padding-left: 25px;
            border-left: 4px solid #FFD700;
        }

        .list-group-item.active-category {
            background-color: #1c1c1c;
            color: #FFD700;
            border-left: 4px solid #FFD700;
        }

    .price-text {
        font-size: 1.25rem;
        font-weight: 800;
        color: #1c1c1c;
    }

    .btn-garage-sm {
        background-color: #1c1c1c;
        color: #fff;
        font-size: 0.85rem;
        padding: 8px 15px;
        border-radius: 20px;
        transition: all 0.3s;
    }

        .btn-garage-sm:hover {
            background-color: #FFD700;
            color: #1c1c1c;
        }
</style>

<div id="mainCarousel" class="carousel slide mb-5 shadow-lg" data-bs-ride="carousel">

    <div class="carousel-indicators">
        <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="2"></button>
        <button type="button" data-bs-target="#mainCarousel" data-bs-slide-to="3"></button>
    </div>

    <div class="carousel-inner rounded-bottom">

        @if (firsatUrunu != null)
        {
            <div class="carousel-item active">
                <div class="hero-pattern"></div>
                <div class="container h-100">
                    <div class="row h-100 align-items-center">
                        <div class="col-md-7 ps-md-5 z-2">
                            <span class="badge bg-warning text-dark mb-3 px-3 py-2 fw-bold">GÜNÜN FIRSATI</span>
                            <h1 class="display-4 fw-bold text-white mb-3">@firsatUrunu.Title</h1>
                            <p class="lead text-white-50 mb-4">Bu fiyata kaçmaz! Satıcı acil satıyor, hemen detayları incele ve teklif ver.</p>
                            <a href="/Product/ProductDetails/@firsatUrunu.ProductID" class="btn btn-light btn-lg fw-bold rounded-pill px-5 shadow">
                                İlanı İncele <i class="fas fa-arrow-right ms-2"></i>
                            </a>
                        </div>
                        <div class="col-md-5 d-none d-md-block text-center z-2">
                            <img src="@(string.IsNullOrEmpty(firsatUrunu.ImageUrl) ? "https://dummyimage.com/400x300/fff/000" : firsatUrunu.ImageUrl)"
                                 class="shadow-lg rounded-4 border border-4 border-white"
                                 style="max-height: 280px; transform: rotate(-3deg);"
                                 alt="@firsatUrunu.Title" />
                        </div>
                    </div>
                </div>
            </div>
        }

        <div class="carousel-item">
            <div class="hero-pattern" style="background: linear-gradient(135deg, transparent 0%, rgba(13, 110, 253, 0.1) 100%);"></div>
            <div class="container h-100">
                <div class="row h-100 align-items-center">
                    <div class="col-md-7 ps-md-5 z-2">
                        <h1 class="display-4 fw-bold text-white">Güvenli Alışverişin <br><span style="color: #FFD700;">Yeni Adresi</span></h1>
                        <p class="lead text-white-50 mb-4">Sıfır kadar temiz, ikinci el kadar hesaplı! Cüzdanın güvende, alışverişin keyifli olsun.</p>
                        <a href="#products" class="btn btn-outline-light btn-lg fw-bold rounded-pill px-5">Keşfetmeye Başla</a>
                    </div>
                    <div class="col-md-5 d-none d-md-block text-center opacity-50">
                        <i class="fas fa-shield-alt fa-10x text-white"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="carousel-item">
            <div class="hero-pattern" style="background: linear-gradient(135deg, transparent 0%, rgba(220, 53, 69, 0.1) 100%);"></div>
            <div class="container h-100">
                <div class="row h-100 align-items-center">
                    <div class="col-md-7 ps-md-5 z-2">
                        <h1 class="display-4 fw-bold text-white">Eşyaların Nakite <br>Dönüşsün!</h1>
                        <p class="lead text-white-50 mb-4">Evinin bir köşesinde bekleyen eşyaları Garage ile saniyeler içinde ilana koy.</p>
                        <a href="@(User.Identity.IsAuthenticated ? "/Product/AddProduct" : "/Login/Index")"
                           class="btn btn-warning btn-lg fw-bold rounded-pill px-5 text-dark shadow">
                            <i class="fas fa-camera me-2"></i> Ücretsiz İlan Ver
                        </a>
                    </div>
                    <div class="col-md-5 d-none d-md-block text-center opacity-50">
                        <i class="fas fa-camera-retro fa-10x text-white"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="carousel-item">
            <div class="hero-pattern" style="background: linear-gradient(135deg, transparent 0%, rgba(25, 135, 84, 0.1) 100%);"></div>
            <div class="container h-100">
                <div class="row h-100 align-items-center">
                    <div class="col-md-7 ps-md-5 z-2">
                        <h1 class="display-4 fw-bold text-white">En Yeni <span class="text-success">Teknolojiler</span></h1>
                        <p class="lead text-white-50 mb-4">Telefon, Bilgisayar ve Oyun Konsollarında kaçırılmayacak fırsatlar seni bekliyor.</p>
                        <a href="/Product/Index" class="btn btn-success btn-lg fw-bold rounded-pill px-5 shadow">İlanlara Git</a>
                    </div>
                    <div class="col-md-5 d-none d-md-block text-center opacity-50">
                        <i class="fas fa-laptop fa-10x text-white"></i>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div class="container mb-5" id="products">
    <div class="row">

        <div class="col-lg-3 mb-4">

            <div class="card shadow-sm border-0 mb-4">
                <div class="card-header bg-white border-0 pt-4 px-4 pb-2">
                    <h5 class="fw-bold text-dark"><i class="fas fa-bars me-2 text-warning"></i>Kategoriler</h5>
                </div>
                <div class="card-body p-2">
                    <div class="list-group list-group-flush">
                        @if (ViewBag.kategoriler != null)
                        {
                            <a href="/Product/Index" class="list-group-item list-group-item-action fw-bold @(Context.Request.Query["id"].Count == 0 ? "active-category" : "")">
                                <i class="fas fa-th-large me-2"></i> Tüm Ürünler
                            </a>
                            @foreach (var item in (List<Category>)ViewBag.kategoriler)
                            {
                                string activeClass = "";
                                if (Context.Request.Query["id"].ToString() == item.CategoryID.ToString())
                                {
                                    activeClass = "active-category";
                                }

                                <a href="/Product/Index?id=@item.CategoryID" class="list-group-item list-group-item-action @activeClass">
                                    <i class="fas fa-chevron-right me-2 small text-muted"></i> @item.CategoryName
                                </a>
                            }
                        }
                        else
                        {
                            <p class="text-muted p-3">Kategori bulunamadı.</p>
                        }
                    </div>
                </div>
            </div>

            <div class="card border-0 bg-warning text-dark shadow-sm overflow-hidden position-relative">
                <div class="card-body p-4 position-relative z-2">
                    <h5 class="fw-bold">Öne Çıkanlar</h5>
                    <p class="small mb-3">Günün en çok tıklanan fırsat ürünlerini kaçırmayın!</p>
                    <a href="#" class="btn btn-dark btn-sm rounded-pill px-3">İncele</a>
                </div>
                <i class="fas fa-bolt position-absolute text-white opacity-25" style="font-size: 6rem; right: -10px; bottom: -10px;"></i>
            </div>
        </div>

        <div class="col-lg-9">

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="fw-bold mb-0">Vitrin İlanları</h4>
                <span class="text-muted small">@Model.Count ürün listeleniyor</span>
            </div>

            <div class="row gx-4 gx-lg-4 row-cols-1 row-cols-md-2 row-cols-xl-3">

                @if (Model.Count == 0)
                {
                    <div class="col-12">
                        <div class="alert alert-light border shadow-sm text-center py-5">
                            <i class="fas fa-search fa-3x text-muted mb-3"></i>
                            <h5 class="text-dark fw-bold">Üzgünüz, sonuç bulunamadı.</h5>
                            <p class="text-muted">Arama kriterlerinizi değiştirerek tekrar deneyebilirsiniz.</p>
                            <a href="/Product/Index" class="btn btn-warning rounded-pill px-4 mt-2">Tüm İlanları Gör</a>
                        </div>
                    </div>
                }

                @foreach (var item in Model)
                {
                    <div class="col mb-4">
                        <div class="card h-100 product-card shadow-sm">

                            @if (item.IsSold)
                            {
                                <div class="badge bg-danger position-absolute shadow-sm" style="top: 15px; left: 15px; z-index: 10;">
                                    <i class="fas fa-lock me-1"></i> Satıldı
                                </div>
                            }
                            else
                            {
                                <div class="badge bg-success position-absolute shadow-sm" style="top: 15px; left: 15px; z-index: 10;">
                                    <i class="fas fa-check me-1"></i> Yayında
                                </div>
                            }

                            <a href="/Product/ProductDetails/@item.ProductID" class="card-img-wrapper">
                                <img class="card-img-top" src="@(string.IsNullOrEmpty(item.ImageUrl) ? "https://dummyimage.com/450x300/dee2e6/6c757d.jpg" : item.ImageUrl)" alt="@item.Title" />
                            </a>

                            <div class="card-body p-3 d-flex flex-column">

                                <h5 class="fw-bold mb-1">
                                    <a href="/Product/ProductDetails/@item.ProductID" class="text-decoration-none text-dark stretched-link">
                                        @if (item.Title.Length > 20)
                                        {
                                            @item.Title.Substring(0, 20) <text>...</text>
                                        }
                                        else
                                        {

                                            @item.Title
                                        }
                                    </a>
                                </h5>

                                <div class="text-muted small mb-3">
                                    <i class="fas fa-map-marker-alt me-1"></i> @item.City
                                </div>

                                <div class="mt-auto d-flex justify-content-between align-items-center pt-3 border-top">
                                    <span class="price-text">@item.Price.ToString("N0") <small class="text-muted" style="font-size: 0.8rem">₺</small></span>
                                    <button class="btn btn-garage-sm">
                                        İncele <i class="fas fa-chevron-right ms-1" style="font-size: 0.7rem;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>
    </div>
</div>